<!doctype html>
<html lang="pt-BR">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
		<link rel="stylesheet" href="css/singlePageTemplate.css" type="text/css">
        <style>
        html, #map {
            width: 100%;
            height: 80vh;
            padding: 0;
            margin: 0;
        }
		.labels { display: flex; justify-content: space-between; flex-wrap: wrap; }
        .labels span { margin: 0 5px; }
        
        /* Mobile-specific styles */
        @media (max-width: 767px) {
            #timeline_div {
                padding: 20px 15px 30px;
                margin: 20px 0;
            }
            
            .year-label {
                text-align: center;
                margin-bottom: 20px;
                font-size: 18px;
                font-weight: bold;
            }
            
            .slider-container {
                width: 100%;
                padding: 0 10px;
                margin: 0 15px;
            }
            
            .leaflet-control-layers {
                max-height: 70vh;
                overflow-y: auto;
            }
        }
        </style>
        <title>Mapa Temporal com Controle Deslizante</title>
    </head>
    <body>
		<div class="container"> 
  		<header> 
		<a href="PDPA.htm">
    	<div>
      		<h4 class="logo">
			 	NITERÓI VIEW
			</h4>
    	</div>
    </a>
	<nav>
      <ul>
        <li><a href="index.html">HOME</a></li>
        <li><a href="#about">SOBRE</a></li>
        <li><a href="#contact">CONTATO</a></li>
      </ul>
    </nav>
    </header>
        <div id="map">
        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/multi-style-layer.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="data/Agua_Niteroi_0.js"></script>
        <script src="data/Terreno_Niteroi_1.js"></script>
        <script src="data/Lagunas_2.js"></script>
        <script src="data/Area_Urbana_4.js"></script>
        <script src="data/CurvasdeNvel_5.js"></script>
        <script src="data/Logradouros_6.js"></script>
        <script src="data/EdifciosHistricos_7.js"></script>
        <script>
        const CACHE_VERSION = 'v1';
        const CACHE_NAME = `webmap-data-${CACHE_VERSION}`;
        
        var map = L.map('map', {
            zoomControl: false,
            maxZoom: 16,
            minZoom: 13,
            preferCanvas: true,
            renderer: L.canvas()
        }).fitBounds([[-22.912355978919862,-43.142251682921554],[-22.884123543823108,-43.091444563788734]]);
        
        // Create a cache for filtered layers
        var layerCache = {};
        
        if ('caches' in window) {
            caches.open(CACHE_NAME).then(cache => {
                cache.add('data/Logradouros_6.js');
            });
        }
        
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        function addClassToPopupIfMedia(content, popup) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            if (tempDiv.querySelector('td img')) {
                popup._contentNode.classList.add('media');
                setTimeout(function() {
                    popup.update();
                }, 10);
            } else {
                popup._contentNode.classList.remove('media');
            }
        }
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        if (bounds_group.getLayers().length) {
                map.fitBounds(bounds_group.getBounds());
            }
            // Use the original map bounds but expand them significantly to allow extensive panning
            var originalBounds = [[-22.912355978919862,-43.142251682921554],[-22.884123543823108,-43.091444563788734]];
            var expandFactor = 4.0; // 400% expansion for extremely wide panning area
            
            // Calculate expanded bounds
            var latDiff = Math.abs(originalBounds[0][0] - originalBounds[1][0]);
            var lngDiff = Math.abs(originalBounds[0][1] - originalBounds[1][1]);
            
            var expandedBounds = [
                [originalBounds[0][0] - latDiff * expandFactor, originalBounds[0][1] - lngDiff * expandFactor],
                [originalBounds[1][0] + latDiff * expandFactor, originalBounds[1][1] + lngDiff * expandFactor]
            ];
            
            map.setMaxBounds(expandedBounds);
            
        function pop_Agua_Niteroi_0(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tipo'] !== null ? autolinker.link(String(feature.properties['Tipo']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Agua_Niteroi_0_0() {
            return {
                pane: 'pane_Agua_Niteroi_0',
                opacity: 1,
                color: 'rgba(149,214,233,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(152,218,238,1.0)',
                interactive: false,
            }
        }
        map.createPane('pane_Agua_Niteroi_0');
        map.getPane('pane_Agua_Niteroi_0').style.zIndex = 400;
        map.getPane('pane_Agua_Niteroi_0').style['mix-blend-mode'] = 'normal';
        var layer_Agua_Niteroi_0 = new L.geoJson(json_Agua_Niteroi_0, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Agua_Niteroi_0',
            layerName: 'layer_Agua_Niteroi_0',
            pane: 'pane_Agua_Niteroi_0',
            onEachFeature: pop_Agua_Niteroi_0,
            style: style_Agua_Niteroi_0_0,
        });
        bounds_group.addLayer(layer_Agua_Niteroi_0);
        map.addLayer(layer_Agua_Niteroi_0);
        function pop_Terreno_Niteroi_1(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tipo'] !== null ? autolinker.link(String(feature.properties['Tipo']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['data_abert'] !== null ? autolinker.link(String(feature.properties['data_abert']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Terreno_Niteroi_1_0(feature) {
            switch(String(feature.properties['Tipo'])) {
                case 'Terra':
                    return {
                pane: 'pane_Terreno_Niteroi_1',
                opacity: 1,
                color: 'rgba(225,249,227,0.792)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(214,248,226,0.792)',
                interactive: false,
            }
                    break;
                case 'Areia':
                    return {
                pane: 'pane_Terreno_Niteroi_1',
                opacity: 1,
                color: 'rgba(225,249,227,0.792)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(246,236,207,0.792)',
                interactive: false,
            }
                    break;
            }
        }
        map.createPane('pane_Terreno_Niteroi_1');
        map.getPane('pane_Terreno_Niteroi_1').style.zIndex = 401;
        map.getPane('pane_Terreno_Niteroi_1').style['mix-blend-mode'] = 'normal';
        var layer_Terreno_Niteroi_1 = new L.geoJson(json_Terreno_Niteroi_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Terreno_Niteroi_1',
            layerName: 'layer_Terreno_Niteroi_1',
            pane: 'pane_Terreno_Niteroi_1',
            onEachFeature: pop_Terreno_Niteroi_1,
            style: style_Terreno_Niteroi_1_0,
        });
        var originalFeatures_Terreno = json_Terreno_Niteroi_1.features;
        bounds_group.addLayer(layer_Terreno_Niteroi_1);
        map.addLayer(layer_Terreno_Niteroi_1);
        function pop_Lagunas_2(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['OBJECTID'] !== null ? autolinker.link(String(feature.properties['OBJECTID']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NOME'] !== null ? autolinker.link(String(feature.properties['NOME']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Lagunas_2_0() {
            return {
                pane: 'pane_Lagunas_2',
                opacity: 1,
                color: 'rgba(144,206,225,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(152,218,238,1.0)',
                interactive: false,
            }
        }
        map.createPane('pane_Lagunas_2');
        map.getPane('pane_Lagunas_2').style.zIndex = 402;
        map.getPane('pane_Lagunas_2').style['mix-blend-mode'] = 'normal';
        var layer_Lagunas_2 = new L.geoJson(json_Lagunas_2, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Lagunas_2',
            layerName: 'layer_Lagunas_2',
            pane: 'pane_Lagunas_2',
            onEachFeature: pop_Lagunas_2,
            style: style_Lagunas_2_0,
        });
        bounds_group.addLayer(layer_Lagunas_2);
        map.addLayer(layer_Lagunas_2);
        map.createPane('pane_MDE_Niteroi_3');
        map.getPane('pane_MDE_Niteroi_3').style.zIndex = 403;
        var img_MDE_Niteroi_3 = 'data/MDE_Niteroi_3.png';
        var img_bounds_MDE_Niteroi_3 = [[-23.082361111,-43.705694444],[-22.507083333,-42.62875]];
        var layer_MDE_Niteroi_3 = new L.imageOverlay(img_MDE_Niteroi_3,
                                              img_bounds_MDE_Niteroi_3,
                                              {pane: 'pane_MDE_Niteroi_3'});
        bounds_group.addLayer(layer_MDE_Niteroi_3);
        map.addLayer(layer_MDE_Niteroi_3);
        function pop_Area_Urbana_4(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Data_abert'] !== null ? autolinker.link(String(feature.properties['Data_abert']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Data_fecha'] !== null ? autolinker.link(String(feature.properties['Data_fecha']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Area_Urbana_4_0() {
            return {
                pane: 'pane_Area_Urbana_4',
                opacity: 1,
                color: 'rgba(219,219,219,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(219,219,219,1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_Area_Urbana_4');
        map.getPane('pane_Area_Urbana_4').style.zIndex = 404;
        map.getPane('pane_Area_Urbana_4').style['mix-blend-mode'] = 'normal';
        var layer_Area_Urbana_4 = new L.geoJson(json_Area_Urbana_4, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Area_Urbana_4',
            layerName: 'layer_Area_Urbana_4',
            pane: 'pane_Area_Urbana_4',
            onEachFeature: pop_Area_Urbana_4,
            style: style_Area_Urbana_4_0,
        });
        var originalFeatures_Area = json_Area_Urbana_4.features;
        bounds_group.addLayer(layer_Area_Urbana_4);
        map.addLayer(layer_Area_Urbana_4);
        function pop_CurvasdeNvel_5(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['ID_OBJETO'] !== null ? autolinker.link(String(feature.properties['ID_OBJETO']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['COTA'] !== null ? autolinker.link(String(feature.properties['COTA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_CurvasdeNvel_5_0() {
            return {
                pane: 'pane_CurvasdeNvel_5',
                opacity: 1,
                color: 'rgba(149,149,149,0.17)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: false,
            }
        }
        map.createPane('pane_CurvasdeNvel_5');
        map.getPane('pane_CurvasdeNvel_5').style.zIndex = 405;
        map.getPane('pane_CurvasdeNvel_5').style['mix-blend-mode'] = 'normal';
        var layer_CurvasdeNvel_5 = new L.geoJson(json_CurvasdeNvel_5, {
            attribution: '',
            interactive: false,
            dataVar: 'json_CurvasdeNvel_5',
            layerName: 'layer_CurvasdeNvel_5',
            pane: 'pane_CurvasdeNvel_5',
            onEachFeature: pop_CurvasdeNvel_5,
            style: style_CurvasdeNvel_5_0,
        });
        bounds_group.addLayer(layer_CurvasdeNvel_5);
        map.addLayer(layer_CurvasdeNvel_5);
        function pop_Logradouros_6(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['nome_compl'] !== null ? autolinker.link(String(feature.properties['nome_compl']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['no_ant'] !== null ? autolinker.link(String(feature.properties['no_ant']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['bairro_dir'] !== null ? autolinker.link(String(feature.properties['bairro_dir']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['data_abert'] !== null ? autolinker.link(String(feature.properties['data_abert']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['data_fecha'] !== null ? autolinker.link(String(feature.properties['data_fecha']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Logradouros_6_0() {
            return {
                pane: 'pane_Logradouros_6',
                opacity: 1,
                color: 'rgba(0,0,0,1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 3.0,
                fillOpacity: 0,
                interactive: true,
            }
        }
        function style_Logradouros_6_1() {
            return {
                pane: 'pane_Logradouros_6',
                opacity: 1,
                color: 'rgba(255,255,255,1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 3.0,
                fillOpacity: 0,
                interactive: true,
            }
        }
        map.createPane('pane_Logradouros_6');
        map.getPane('pane_Logradouros_6').style.zIndex = 406;
        map.getPane('pane_Logradouros_6').style['mix-blend-mode'] = 'normal';
        var layer_Logradouros_6 = new L.geoJson.multiStyle(json_Logradouros_6, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Logradouros_6',
            layerName: 'layer_Logradouros_6',
            pane: 'pane_Logradouros_6',
            onEachFeature: pop_Logradouros_6,
            styles: [style_Logradouros_6_0,style_Logradouros_6_1,]
        });
        var originalFeatures = json_Logradouros_6.features;
        bounds_group.addLayer(layer_Logradouros_6);
        map.addLayer(layer_Logradouros_6);
        function pop_EdifciosHistricos_7(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Bairro'] !== null ? autolinker.link(String(feature.properties['Bairro']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Nome'] !== null ? autolinker.link(String(feature.properties['Nome']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Endereço'] !== null ? autolinker.link(String(feature.properties['Endereço']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tipo'] !== null ? autolinker.link(String(feature.properties['Tipo']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['data_fecha'] !== null ? autolinker.link(String(feature.properties['data_fecha']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['data_abert'] !== null ? autolinker.link(String(feature.properties['data_abert']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_EdifciosHistricos_7_0() {
            return {
                pane: 'pane_EdifciosHistricos_7',
                opacity: 1,
                color: 'rgba(247,247,247,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(150,150,150,1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_EdifciosHistricos_7');
        map.getPane('pane_EdifciosHistricos_7').style.zIndex = 407;
        map.getPane('pane_EdifciosHistricos_7').style['mix-blend-mode'] = 'normal';
        var layer_EdifciosHistricos_7 = new L.geoJson(json_EdifciosHistricos_7, {
            attribution: '',
            interactive: true,
            dataVar: 'json_EdifciosHistricos_7',
            layerName: 'layer_EdifciosHistricos_7',
            pane: 'pane_EdifciosHistricos_7',
            onEachFeature: pop_EdifciosHistricos_7,
            style: style_EdifciosHistricos_7_0,
        });
        var originalFeatures_Edificios = json_EdifciosHistricos_7.features;
        bounds_group.addLayer(layer_EdifciosHistricos_7);
        map.addLayer(layer_EdifciosHistricos_7);
        var overlaysTree = [
            {label: '<img src="legend/EdifciosHistricos_7.png" /> Edifícios Históricos', layer: layer_EdifciosHistricos_7},
            {label: '<img src="legend/Logradouros_6.png" /> Logradouros', layer: layer_Logradouros_6},
            {label: '<img src="legend/CurvasdeNvel_5.png" /> Curvas de Nível', layer: layer_CurvasdeNvel_5},
            {label: '<img src="legend/Area_Urbana_4.png" /> Area_Urbana', layer: layer_Area_Urbana_4},
            {label: "MDE_Niteroi", layer: layer_MDE_Niteroi_3},
            {label: '<img src="legend/Lagunas_2.png" /> Lagunas', layer: layer_Lagunas_2},
            {label: 'Terreno_Niteroi<br /><table><tr><td style="text-align: center;"><img src="legend/Terreno_Niteroi_1_Terra0.png" /></td><td>Terra</td></tr><tr><td style="text-align: center;"><img src="legend/Terreno_Niteroi_1_Areia1.png" /></td><td>Areia</td></tr></table>', layer: layer_Terreno_Niteroi_1},
            {label: '<img src="legend/Agua_Niteroi_0.png" /> Agua_Niteroi', layer: layer_Agua_Niteroi_0},]
        // Layer control has been disabled
        // All layers will remain visible at all times
        
        map.on("zoomend", function(){

                if (map.hasLayer(layer_Logradouros_6)) {
                    if (map.getZoom() <= 13 && map.getZoom() >= 19) {
                        layer_Logradouros_6.eachLayer(function (layer) {
                            layer.openTooltip();
                        });
                    } else {
                        layer_Logradouros_6.eachLayer(function (layer) {
                            layer.closeTooltip();
                        });
                    }
                }
        });
        setBounds();
        var i = 0;
        layer_Logradouros_6.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['nome_compl'] !== null?String('<div style="color: #323232; font-size: 4pt; font-family: \'Arial\', sans-serif;">' + layer.feature.properties['nome_compl']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Logradouros_6'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
                if (map.hasLayer(layer_Logradouros_6)) {
                    if (map.getZoom() <= 13 && map.getZoom() >= 19) {
                        layer_Logradouros_6.eachLayer(function (layer) {
                            layer.openTooltip();
                        });
                    } else {
                        layer_Logradouros_6.eachLayer(function (layer) {
                            layer.closeTooltip();
                        });
                    }
                }
        L.ImageOverlay.include({
            getBounds: function () {
                return this._bounds;
            }
        });
        resetLabels([layer_Logradouros_6]);
        map.on("zoomend", function(){
            resetLabels([layer_Logradouros_6]);
        });
        map.on("layeradd", function(){
            resetLabels([layer_Logradouros_6]);
        });
        map.on("layerremove", function(){
            resetLabels([layer_Logradouros_6]);
        });
        // Create a spatial index for faster feature lookup
        function createSpatialIndex(features) {
            var index = {};
            features.forEach(function(feature, i) {
                var bounds = getBoundsFromFeature(feature);
                if (bounds) {
                    var key = Math.floor(bounds.getCenter().lat * 100) + '-' + Math.floor(bounds.getCenter().lng * 100);
                    if (!index[key]) index[key] = [];
                    index[key].push(i);
                }
            });
            return index;
        }
        
        function getBoundsFromFeature(feature) {
            if (!feature || !feature.geometry || !feature.geometry.coordinates) return null;
            
            var coords = feature.geometry.coordinates;
            var bounds;
            
            try {
                if (feature.geometry.type === 'Point') {
                    bounds = L.latLngBounds([coords[1], coords[0]], [coords[1], coords[0]]);
                } else if (feature.geometry.type === 'LineString') {
                    bounds = L.latLngBounds();
                    coords.forEach(function(coord) {
                        bounds.extend([coord[1], coord[0]]);
                    });
                } else if (feature.geometry.type === 'Polygon') {
                    bounds = L.latLngBounds();
                    coords[0].forEach(function(coord) {
                        bounds.extend([coord[1], coord[0]]);
                    });
                } else if (feature.geometry.type === 'MultiPolygon') {
                    bounds = L.latLngBounds();
                    coords.forEach(function(polygon) {
                        polygon[0].forEach(function(coord) {
                            bounds.extend([coord[1], coord[0]]);
                        });
                    });
                }
                return bounds;
            } catch (e) {
                console.error("Error creating bounds for feature:", e);
                return null;
            }
        }
        
        // Create spatial indices for all feature collections
        var spatialIndex_Logradouros;
        var spatialIndex_Terreno;
        var spatialIndex_Area;
        var spatialIndex_Edificios;
        spatialIndex_Logradouros = createSpatialIndex(originalFeatures);
        spatialIndex_Terreno = createSpatialIndex(originalFeatures_Terreno);
        spatialIndex_Area = createSpatialIndex(originalFeatures_Area);
        spatialIndex_Edificios = createSpatialIndex(originalFeatures_Edificios);
        // Add debouncing to prevent excessive rendering during slider movement
        var debounceTimer;
        function debouncedUpdateYear(value) {
            document.getElementById('year').textContent = value;
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(function() {
                updateYear(value);
            }, 100); // 100ms debounce time
        }

        function updateYear(value) {
            var selectedYear = parseInt(value);
            
            // Check if we have a cached layer for this year
            var cacheKey = 'year_' + selectedYear;
            if (layerCache[cacheKey]) {
                // Use cached layers
                if (map.hasLayer(layer_Logradouros_6)) map.removeLayer(layer_Logradouros_6);
                if (map.hasLayer(layer_Terreno_Niteroi_1)) map.removeLayer(layer_Terreno_Niteroi_1);
                if (map.hasLayer(layer_Area_Urbana_4)) map.removeLayer(layer_Area_Urbana_4);
                if (map.hasLayer(layer_EdifciosHistricos_7)) map.removeLayer(layer_EdifciosHistricos_7);
                
                layer_Logradouros_6 = layerCache[cacheKey].logradouros;
                layer_Terreno_Niteroi_1 = layerCache[cacheKey].terreno;
                layer_Area_Urbana_4 = layerCache[cacheKey].area;
                layer_EdifciosHistricos_7 = layerCache[cacheKey].edificios;
                
                map.addLayer(layer_Logradouros_6);
                map.addLayer(layer_Terreno_Niteroi_1);
                map.addLayer(layer_Area_Urbana_4);
                map.addLayer(layer_EdifciosHistricos_7);
                
                // Reset labels for all filtered layers
                resetLabels([layer_Logradouros_6, layer_Terreno_Niteroi_1, layer_Area_Urbana_4, layer_EdifciosHistricos_7]);
                return;
            }
            
            // Helper function to filter features by date - optimized version
            function filterFeaturesByDate(features) {
                return features.filter(function(feature) {
                    try {
                        var dataAbertStr = feature.properties.Data_abert || feature.properties.data_abert || feature.properties.Data_Abert;
                        var dataFechaStr = feature.properties.Data_fecha || feature.properties.data_fecha || feature.properties.Data_Fecha;
                        
                        // Quick early returns for common cases
                        if (!dataAbertStr) return true;
                        
                        // Cache for parsed dates
                        if (!feature._parsedDates) {
                            feature._parsedDates = {};
                        }
                        
                        var dataAbertura, dataFechamento;
                        
                        // Use cached parsed dates if available
                        if (feature._parsedDates.abertura !== undefined) {
                            dataAbertura = feature._parsedDates.abertura;
                        } else {
                            dataAbertura = parseYearFromDate(dataAbertStr);
                            feature._parsedDates.abertura = dataAbertura;
                        }
                        
                        if (feature._parsedDates.fechamento !== undefined) {
                            dataFechamento = feature._parsedDates.fechamento;
                        } else if (dataFechaStr) {
                            dataFechamento = parseYearFromDate(dataFechaStr);
                            feature._parsedDates.fechamento = dataFechamento;
                        } else {
                            dataFechamento = null;
                            feature._parsedDates.fechamento = null;
                        }
                        
                        // If we couldn't parse the opening date, always show the feature
                        if (!dataAbertura) return true;
                         
                        return (dataAbertura <= selectedYear) && 
                               (!dataFechamento || selectedYear <= dataFechamento);
                    } catch (e) {
                        // If there's any error in parsing, show the feature
                        return true;
                    }
                });
            }
            
            // Helper function to parse year from various date formats - extracted for better performance
            function parseYearFromDate(dateStr) {
                if (!dateStr) return null;
                
                if (typeof dateStr === 'number') {
                    return dateStr;
                } else if (dateStr.match(/^\d{4}$/)) {
                    return parseInt(dateStr);
                } else if (dateStr.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    return parseInt(dateStr.substring(0, 4));
                } else {
                    var date = new Date(dateStr);
                    if (!isNaN(date.getTime())) {
                        return date.getFullYear();
                    }
                }
                return null;
            }
            
            // Filter and update Logradouros layer
            if (map.hasLayer(layer_Logradouros_6)) {
                map.removeLayer(layer_Logradouros_6);
            }
            
            var filteredFeatures = filterFeaturesByDate(originalFeatures);
            
            // Simplify geometries based on zoom level for better performance
            var zoomLevel = map.getZoom();
            var simplifyTolerance = zoomLevel < 14 ? 0.0001 : 0;
            
            if (simplifyTolerance > 0) {
                filteredFeatures = simplifyFeatures(filteredFeatures, simplifyTolerance);
            }
            
            var newLayer = new L.geoJson.multiStyle({
                type: "FeatureCollection",
                features: filteredFeatures
            }, {
                attribution: '',
                interactive: true,
                dataVar: 'json_Logradouros_6',
                layerName: 'layer_Logradouros_6',
                pane: 'pane_Logradouros_6',
                onEachFeature: pop_Logradouros_6,
                styles: [style_Logradouros_6_0, style_Logradouros_6_1]
            });
            
            layer_Logradouros_6 = newLayer;
            
            map.addLayer(layer_Logradouros_6);
            
            // Filter and update Terreno layer
            if (map.hasLayer(layer_Terreno_Niteroi_1)) {
                map.removeLayer(layer_Terreno_Niteroi_1);
            }
            
            var filteredTerreno = filterFeaturesByDate(originalFeatures_Terreno);
            
            if (simplifyTolerance > 0) {
                filteredTerreno = simplifyFeatures(filteredTerreno, simplifyTolerance);
            }
            
            var newTerrenoLayer = new L.geoJson({
                type: "FeatureCollection",
                features: filteredTerreno
            }, {
                attribution: '',
                interactive: true,
                dataVar: 'json_Terreno_Niteroi_1',
                layerName: 'layer_Terreno_Niteroi_1',
                pane: 'pane_Terreno_Niteroi_1',
                onEachFeature: pop_Terreno_Niteroi_1,
                style: style_Terreno_Niteroi_1_0
            });
            
            layer_Terreno_Niteroi_1 = newTerrenoLayer;
            map.addLayer(layer_Terreno_Niteroi_1);
            
            // Filter and update Area Urbana layer
            if (map.hasLayer(layer_Area_Urbana_4)) {
                map.removeLayer(layer_Area_Urbana_4);
            }
            
            var filteredArea = filterFeaturesByDate(originalFeatures_Area);
            
            if (simplifyTolerance > 0) {
                filteredArea = simplifyFeatures(filteredArea, simplifyTolerance);
            }
            
            var newAreaLayer = new L.geoJson({
                type: "FeatureCollection",
                features: filteredArea
            }, {
                attribution: '',
                interactive: true,
                dataVar: 'json_Area_Urbana_4',
                layerName: 'layer_Area_Urbana_4',
                pane: 'pane_Area_Urbana_4',
                onEachFeature: pop_Area_Urbana_4,
                style: style_Area_Urbana_4_0
            });
            
            layer_Area_Urbana_4 = newAreaLayer;
            map.addLayer(layer_Area_Urbana_4);
            
            // Filter and update Edificios Historicos layer
            if (map.hasLayer(layer_EdifciosHistricos_7)) {
                map.removeLayer(layer_EdifciosHistricos_7);
            }
            
            var filteredEdificios = filterFeaturesByDate(originalFeatures_Edificios);
            
            var newEdificiosLayer = new L.geoJson({
                type: "FeatureCollection",
                features: filteredEdificios
            }, {
                attribution: '',
                interactive: true,
                dataVar: 'json_EdifciosHistricos_7',
                layerName: 'layer_EdifciosHistricos_7',
                pane: 'pane_EdifciosHistricos_7',
                onEachFeature: pop_EdifciosHistricos_7,
                style: style_EdifciosHistricos_7_0
            });
            
            layer_EdifciosHistricos_7 = newEdificiosLayer;
            map.addLayer(layer_EdifciosHistricos_7);
            
            // Cache the layers for this year
            layerCache[cacheKey] = {
                logradouros: layer_Logradouros_6,
                terreno: layer_Terreno_Niteroi_1,
                area: layer_Area_Urbana_4,
                edificios: layer_EdifciosHistricos_7
            };
            
            // Limit cache size to prevent memory issues
            var cacheKeys = Object.keys(layerCache);
            if (cacheKeys.length > 10) { // Keep only 10 years in cache
                delete layerCache[cacheKeys[0]];
            }
            
            // Reset labels for all filtered layers
            resetLabels([layer_Logradouros_6, layer_Terreno_Niteroi_1, layer_Area_Urbana_4, layer_EdifciosHistricos_7]);
        }
        
        // Function to simplify geometries for better performance
        function simplifyFeatures(features, tolerance) {
            return features.map(function(feature) {
                // Create a deep copy to avoid modifying original
                var simplifiedFeature = JSON.parse(JSON.stringify(feature));
                
                try {
                    if (feature.geometry.type === 'LineString') {
                        simplifiedFeature.geometry.coordinates = simplifyLineString(feature.geometry.coordinates, tolerance);
                    } else if (feature.geometry.type === 'Polygon') {
                        simplifiedFeature.geometry.coordinates = feature.geometry.coordinates.map(function(ring) {
                            return simplifyLineString(ring, tolerance);
                        });
                    } else if (feature.geometry.type === 'MultiPolygon') {
                        simplifiedFeature.geometry.coordinates = feature.geometry.coordinates.map(function(polygon) {
                            return polygon.map(function(ring) {
                                return simplifyLineString(ring, tolerance);
                            });
                        });
                    }
                } catch (e) {
                    console.error("Error simplifying feature:", e);
                }
                
                return simplifiedFeature;
            });
        }
        
        // Douglas-Peucker line simplification
        function simplifyLineString(points, tolerance) {
            if (points.length <= 2) return points;
            
            var sqTolerance = tolerance * tolerance;
            
            // Find the point with the maximum distance
            var maxDist = 0;
            var index = 0;
            var end = points.length - 1;
            
            for (var i = 1; i < end; i++) {
                var dist = pointToLineDistance(points[i], points[0], points[end]);
                if (dist > maxDist) {
                    index = i;
                    maxDist = dist;
                }
            }
            
            // If max distance is greater than tolerance, recursively simplify
            var result = [];
            if (maxDist > sqTolerance) {
                var firstHalf = simplifyLineString(points.slice(0, index + 1), tolerance);
                var secondHalf = simplifyLineString(points.slice(index), tolerance);
                
                // Concatenate the two simplified parts
                result = firstHalf.slice(0, firstHalf.length - 1).concat(secondHalf);
            } else {
                result = [points[0], points[end]];
            }
            
            return result;
        }
        
        // Calculate squared distance from a point to a line segment
        function pointToLineDistance(p, a, b) {
            var x = p[0], y = p[1];
            var x1 = a[0], y1 = a[1];
            var x2 = b[0], y2 = b[1];
            
            var A = x - x1;
            var B = y - y1;
            var C = x2 - x1;
            var D = y2 - y1;
            
            var dot = A * C + B * D;
            var len_sq = C * C + D * D;
            var param = -1;
            
            if (len_sq !== 0) param = dot / len_sq;
            
            var xx, yy;
            
            if (param < 0) {
                xx = x1;
                yy = y1;
            } else if (param > 1) {
                xx = x2;
                yy = y2;
            } else {
                xx = x1 + param * C;
                yy = y1 + param * D;
            }
            
            var dx = x - xx;
            var dy = y - yy;
            
            return dx * dx + dy * dy;
        }
        
        createLabels();
        updateYear(document.getElementById('timeline').value);
        
        // Update the slider to use the debounced function
        document.getElementById('timeline').oninput = function() {
            debouncedUpdateYear(this.value);
        };
        </script>
			 <div id="timeline_div">
			    <div class="year-label">Year: <span id="year">2020</span></div>
			    <div class="slider-container">
			        <input type="range" id="timeline" min="1820" max="2020" value="2020" step="10" oninput="updateYear(this.value)">
			        <div class="labels" id="labels"></div>
			    </div>
			 </div>
			 <style>
			#timeline_div {
				width: 100%;
				padding: 15px 20px 25px;
				background-color: #f8f9fa;
				border-radius: 8px;
				box-shadow: 0 2px 4px rgba(0,0,0,0.1);
				margin: 15px 0;
				box-sizing: border-box;
			}
			
			.year-label {
				font-family: Arial, sans-serif;
				font-size: 16px;
				color: #555;
				margin-bottom: 15px;
				font-weight: bold;
				text-align: center;
			}
			
			.slider-container {
				position: relative;
				padding: 0 10px;
				margin: 0 15px;
			}
			
			#timeline { 
				width: calc(100% - 30px);
				margin: 15px 15px;
				-webkit-appearance: none;
				appearance: none;
				height: 8px;
				background: linear-gradient(to right, #cfe2f3, #9fc5e8, #6fa8dc);
				border-radius: 5px;
				outline: none;
				box-sizing: border-box;
			}
			
			#timeline::-webkit-slider-thumb {
				-webkit-appearance: none;
				appearance: none;
				width: 28px;
				height: 28px;
				border-radius: 50%;
				background: #3d85c6;
				border: 2px solid #fff;
				cursor: pointer;
				box-shadow: 0 1px 3px rgba(0,0,0,0.3);
			}
			
			#timeline::-moz-range-thumb {
				width: 28px;
				height: 28px;
				border-radius: 50%;
				background: #3d85c6;
				border: 2px solid #fff;
				cursor: pointer;
				box-shadow: 0 1px 3px rgba(0,0,0,0.3);
			}
			
			.labels {
				display: flex;
				justify-content: space-between;
				flex-wrap: wrap;
				margin-top: 10px;
				padding: 0;
				width: calc(100% - 30px);
				margin-left: 15px;
			}
			
			.labels span {
				font-family: Arial, sans-serif;
				font-size: 12px;
				color: #777;
				position: relative;
				text-align: center;
				margin-bottom: 5px;
			}
			
			.labels span::before {
				content: '';
				position: absolute;
				top: -15px;
				left: 50%;
				transform: translateX(-50%);
				width: 1px;
				height: 8px;
				background-color: #aaa;
			}
			
			/* Mobile-specific timeline adjustments */
			@media (max-width: 767px) {
				#timeline_div {
					padding: 20px 15px 30px;
					margin: 20px 0;
				}
				
				.year-label {
					font-size: 18px;
					margin-bottom: 20px;
				}
				
				#timeline {
					height: 10px;
					margin: 20px 15px;
				}
				
				#timeline::-webkit-slider-thumb {
					width: 34px;
					height: 34px;
				}
				
				#timeline::-moz-range-thumb {
					width: 34px;
					height: 34px;
				}
				
				.labels {
					margin-top: 15px;
				}
				
				.labels span {
					font-size: 14px;
					margin: 0 2px 8px;
				}
				
				/* Show fewer labels on small screens */
				.labels span:nth-child(odd):not(:first-child):not(:last-child) {
					display: none;
				}
			}
		</style>
		<script>
        // Remove duplicate initialization
        
        function createLabels() {
            var labelsDiv = document.getElementById('labels');
            labelsDiv.innerHTML = ''; 
            
            // Define key years to display (matching the data range 1820-2020)
            var years = [1820, 1870, 1920, 1970, 2020];
            
            // Create a label for each year
            years.forEach(function(year) {
                var label = document.createElement('span');
                label.textContent = year;
                labelsDiv.appendChild(label);
            });
        }

        function updateYear(value) {
            document.getElementById('year').textContent = value;
            var selectedYear = parseInt(value);
            
            // Helper function to filter features by date
            function filterFeaturesByDate(features) {
                return features.filter(function(feature) {
                    try {
                        var dataAbertStr = feature.properties.Data_abert || feature.properties.data_abert || feature.properties.Data_Abert;
                        var dataFechaStr = feature.properties.Data_fecha || feature.properties.data_fecha || feature.properties.Data_Fecha;
                        
                        // If opening date is null/empty, always show the feature
                        if (!dataAbertStr) {
                            return true;
                        }
                        
                        var dataAbertura = null;
                        var dataFechamento = null;
                        
                        // Cache for parsed dates
                        if (!feature._parsedDates) {
                            feature._parsedDates = {};
                        }
                        
                        var dataAbertura, dataFechamento;
                        
                        // Use cached parsed dates if available
                        if (feature._parsedDates.abertura !== undefined) {
                            dataAbertura = feature._parsedDates.abertura;
                        } else {
                            dataAbertura = parseYearFromDate(dataAbertStr);
                            feature._parsedDates.abertura = dataAbertura;
                        }
                        
                        if (feature._parsedDates.fechamento !== undefined) {
                            dataFechamento = feature._parsedDates.fechamento;
                        } else if (dataFechaStr) {
                            dataFechamento = parseYearFromDate(dataFechaStr);
                            feature._parsedDates.fechamento = dataFechamento;
                        } else {
                            dataFechamento = null;
                            feature._parsedDates.fechamento = null;
                        }
                        
                        // If we couldn't parse the opening date, always show the feature
                        if (!dataAbertura) return true;
                         
                        var isVisible = (dataAbertura <= selectedYear) && 
                               (!dataFechamento || selectedYear <= dataFechamento);
                        
                        return isVisible;
                    } catch (e) {
                        // If there's any error in parsing, show the feature
                        return true;
                    }
                });
            }
            
            // Helper function to parse year from various date formats - extracted for better performance
            function parseYearFromDate(dateStr) {
                if (!dateStr) return null;
                
                if (typeof dateStr === 'number') {
                    return dateStr;
                } else if (dateStr.match(/^\d{4}$/)) {
                    return parseInt(dateStr);
                } else if (dateStr.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    return parseInt(dateStr.substring(0, 4));
                } else {
                    var date = new Date(dateStr);
                    if (!isNaN(date.getTime())) {
                        return date.getFullYear();
                    }
                }
                return null;
            }
            
            // Filter and update Logradouros layer
            if (map.hasLayer(layer_Logradouros_6)) {
                map.removeLayer(layer_Logradouros_6);
            }
            
            var filteredFeatures = filterFeaturesByDate(originalFeatures);
            
            var newLayer = new L.geoJson.multiStyle({
                type: "FeatureCollection",
                features: filteredFeatures
            }, {
                attribution: '',
                interactive: true,
                dataVar: 'json_Logradouros_6',
                layerName: 'layer_Logradouros_6',
                pane: 'pane_Logradouros_6',
                onEachFeature: pop_Logradouros_6,
                styles: [style_Logradouros_6_0, style_Logradouros_6_1]
            });
            
            layer_Logradouros_6 = newLayer;
            
            map.addLayer(layer_Logradouros_6);
            
            // Filter and update Terreno layer
            if (map.hasLayer(layer_Terreno_Niteroi_1)) {
                map.removeLayer(layer_Terreno_Niteroi_1);
            }
            
            var filteredTerreno = filterFeaturesByDate(originalFeatures_Terreno);
            
            var newTerrenoLayer = new L.geoJson({
                type: "FeatureCollection",
                features: filteredTerreno
            }, {
                attribution: '',
                interactive: true,
                dataVar: 'json_Terreno_Niteroi_1',
                layerName: 'layer_Terreno_Niteroi_1',
                pane: 'pane_Terreno_Niteroi_1',
                onEachFeature: pop_Terreno_Niteroi_1,
                style: style_Terreno_Niteroi_1_0
            });
            
            layer_Terreno_Niteroi_1 = newTerrenoLayer;
            map.addLayer(layer_Terreno_Niteroi_1);
            
            // Filter and update Area Urbana layer
            if (map.hasLayer(layer_Area_Urbana_4)) {
                map.removeLayer(layer_Area_Urbana_4);
            }
            
            var filteredArea = filterFeaturesByDate(originalFeatures_Area);
            
            var newAreaLayer = new L.geoJson({
                type: "FeatureCollection",
                features: filteredArea
            }, {
                attribution: '',
                interactive: true,
                dataVar: 'json_Area_Urbana_4',
                layerName: 'layer_Area_Urbana_4',
                pane: 'pane_Area_Urbana_4',
                onEachFeature: pop_Area_Urbana_4,
                style: style_Area_Urbana_4_0
            });
            
            layer_Area_Urbana_4 = newAreaLayer;
            map.addLayer(layer_Area_Urbana_4);
            
            // Filter and update Edificios Historicos layer
            if (map.hasLayer(layer_EdifciosHistricos_7)) {
                map.removeLayer(layer_EdifciosHistricos_7);
            }
            
            var filteredEdificios = filterFeaturesByDate(originalFeatures_Edificios);
            
            var newEdificiosLayer = new L.geoJson({
                type: "FeatureCollection",
                features: filteredEdificios
            }, {
                attribution: '',
                interactive: true,
                dataVar: 'json_EdifciosHistricos_7',
                layerName: 'layer_EdifciosHistricos_7',
                pane: 'pane_EdifciosHistricos_7',
                onEachFeature: pop_EdifciosHistricos_7,
                style: style_EdifciosHistricos_7_0
            });
            
            layer_EdifciosHistricos_7 = newEdificiosLayer;
            map.addLayer(layer_EdifciosHistricos_7);
            
            // Reset labels for all filtered layers
            resetLabels([layer_Logradouros_6, layer_Terreno_Niteroi_1, layer_Area_Urbana_4, layer_EdifciosHistricos_7]);
        }
        createLabels();
        updateYear(document.getElementById('timeline').value);
		
    </script>
		<style>
			#timeline { 
            width: 100%;
            margin: 10px 0;
			}
		</style>
		</div>	
    </body>
</html>
